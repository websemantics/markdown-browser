<?php 
/* Change content folder, i.e. '/docs' */
define('CONTENT_DIR', realpath(dirname(__FILE__)).'/');

$content = '';
$parser = new Parsedown();

if($url = trim(strpos($url = $_SERVER["REQUEST_URI"], 'index.php') > 0 ? substr($url,10) : $url, '/')) {

  /* Get the file path. If a folder, attempt to locate README.md  */
  $path = CONTENT_DIR . $url;
  $path .= @is_dir($path) ? "/README.md" : '';
  $extension = @pathinfo($path)['extension'];
  $content = @file_exists($path) ? @file_get_contents($path) : '';

  /* Wrap the content inside a suitable markdown bsed on mime type (text, image etc) */
  list($type, $subtype) = explode('/', @mime_content_type($path));

  switch($type){
    case "image" : 
      $content = $parser->text("![](/$url)");
    break;
    case "text" : 
        $content = $parser->text($extension === 'md' ? $content : "```$extension\n$content\n```" );
    break;
    default : 
        $content = "<pre>$content</pre>";
    break;
  }

  /* Otherwise, report missing content (404)! */
  $content = $content ? : $parser->text("## Error 404 :\n\nThe page is not found");
}

header('Content-type: text/html; charset=utf-8');

if(empty($content)) { ?>
<!-- (1) Application Page Template ( Sidebar | Content )-->
<!DOCTYPE html>
<html>
<head>
<title>Markdown Browser</title>
<style>
/**  Application ayout */
._container,._content,._wrapper{box-sizing:border-box;height:100%;position:relative}._tree,._tree ul{list-style:none;margin:0}html{height:100%}body{height:100%;margin:0;overflow:auto;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";overflow-wrap:break-word;word-wrap:break-word}pre{white-space:pre-wrap}.icon{color:#9a9a9a;margin-right:6px;vertical-align:text-bottom}._wrapper{background:#fff;overflow:hidden;padding-top:0;z-index:1}._content,._sidebar{display:block;outline:0;overflow-y:scroll}._container{margin-left:300px;pointer-events:none;z-index:1}._content{font-size:.875rem;margin-left:.875rem;pointer-events:auto}._sidebar{-ms-overflow-style:none;-webkit-overflow-scrolling:touch;bottom:0;left:0;margin-top:1px;overflow-x:hidden;position:absolute;top:0;z-index:2}._tree input[type=checkbox],._tree ul{display:none}._content::-webkit-scrollbar,._sidebar::-webkit-scrollbar{-webkit-appearance:none;width:10px}._content::-webkit-scrollbar-button,._sidebar::-webkit-scrollbar-button{display:none}._content::-webkit-scrollbar-track,._sidebar::-webkit-scrollbar-track{background:#fff}._content::-webkit-scrollbar-thumb,._sidebar::-webkit-scrollbar-thumb{background:padding-box #d2d2d2;border:3px solid #fff;border-radius:5px;min-height:2rem}._content::-webkit-scrollbar-thumb:active,._sidebar::-webkit-scrollbar-thumb:active{background:#aaa;border-width:2px}._tree-wrapper{min-height:100%;border-right:1px solid #ddd}._tree{padding:0 0 3.5rem;width:300px;font-size:14px}._tree ul{padding:0}._tree label,._tree li a{padding:6px;color:#4078c0;text-decoration:none;display:block}._tree li,._tree li+li{margin:0;user-select:none;line-height:20px;border-top:1px solid #eee}._tree>li:first-child{border-top:0}._tree label{margin-right:11px}._tree label:hover{background:#f5f5f5}._tree li a{margin:-6px}._tree a:active,._tree a:focus{color:#9A9A9A}._tree input[type=checkbox]:checked+label+ul,._tree input[type=checkbox]:checked+label:nth-of-type(n)+ul{display:block}._tree label svg.folder path{fill:#80a6cd}._tree label svg.folder path.open{fill:none}._tree input[type=checkbox]:checked+label svg.folder path.open{fill:#fff}
/**  Sidebar Settings */
._container { margin-left: 250px; }
._tree, ._sidebar { width: 250px; }
</style>
</head>
<body>
  <div class="_wrapper">
    <div class="_header"></div>
      <div class="_sidebar">
        <div id="tree" class="_tree-wrapper"><?php  
            /* Build the files tree of the content folder (CONTENT_DIR) */
            function fileTree($path = CONTENT_DIR, $relative = '') {
              $files = [];
              foreach (scandir($path) as $file) {
                if (strpos($file, '.') !== (int) 0) {
                  $files[$relative.$file] = is_dir("$path/$file") ? fileTree("$path/$file", $relative.$file.'/') : $file;
                }
              }
              return $files;
            }
            /* Parse the files tree and generate html */
            function parseTree($files, $nested = 0){
                $tree = '';
                $padding = $nested * 16 + 6;

                foreach ($files as $path => $value) {
                  $parts = explode('/',$path);

                  /* Sanitize name,  http://stackoverflow.com/questions/2103797/url-friendly-username-in-php */
                  $name = 'folder-'.strtolower(trim(preg_replace('~[^0-9a-z]+~i', '-', html_entity_decode(preg_replace('~&([a-z]{1,2})(?:acute|cedil|circ|grave|lig|orn|ring|slash|th|tilde|uml);~i', '$1', htmlentities($path, ENT_QUOTES, 'UTF-8')), ENT_QUOTES, 'UTF-8')), '-'));

                  if (is_array($value)) {
                      $tree .= "<li><input type='checkbox' name ='$name' id='$name'>".
                          "<label for='$name' style='padding-left:".$padding."px'><svg xmlns='http://www.w3.org/2000/svg' width='14' height='16' viewBox='0 0 14 16' class='folder icon'><path d='M13 4H9V3c0-.66-.31-1-1-1H1c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1zM8 4H1V3h7z'/><path class='open' d='M1 3v4.094h12V4.97H8V3H1z'/></svg>". end($parts) . "</label>".
                          '<ul>'.parseTree($value, $nested + 1).'</ul></li>';
                  } else {
                      $tree .= "<li><label  style='padding-left:".$padding."px'><a target='iframe' href='index.php/$path'><svg xmlns='http://www.w3.org/2000/svg' width='12' height='16' viewBox='0 0 12 16' class='icon'><path fill='#777777' d='M6 5H2V4h4v1zM2 8h7V7H2v1zm0 2h7V9H2v1zm0 2h7v-1H2v1zm10-7.5V14c0 .6-.5 1-1 1H1c-.6 0-1-.5-1-1V2c0-.6.5-1 1-1h7.5L12 4.5zM11 5L8 2H1v12h10V5z'/></svg>$value</a></label></li>";
                  }
                } 
                return $tree;  }?>
          <div class='_tree'><?php echo parseTree( fileTree() ); ?></div>
        </div>
    </div>
    <div class="_container">
      <main class="_content">
        <iframe  name="iframe" frameborder="0" style="overflow: hidden; height: 100%; width: 100%; position: absolute;" onload="this.style.height = this.contentWindow.document.body.scrollHeight + 'px'" height="100%" width="100%" src="/index.php/README.md" ></iframe>
      </main>
    </div>
  </div>
</body>
</html>
<?php } else { ?>
<!-- (2) Markdown Page Template (Html Shell)-->
<!DOCTYPE html>
<html>
<head>
<title>Markdown Browser</title>
<style>
/**  https://github.com/sindresorhus/github-markdown-css */
.markdown-body hr::after,.markdown-body::after{clear:both}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#333;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body .pl-c{color:#969896}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#0086b3}.markdown-body .pl-e,.markdown-body .pl-en{color:#795da3}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#333}.markdown-body .pl-ent{color:#63a35c}.markdown-body .pl-k{color:#a71d5d}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#183691}.markdown-body .pl-v{color:#ed6a43}.markdown-body .pl-id{color:#b52a1d}.markdown-body .pl-ii{color:#f8f8f8;background-color:#b52a1d}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#63a35c}.markdown-body .pl-ml{color:#693a17}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#1d3e81}.markdown-body .pl-mq{color:teal}.markdown-body .pl-mi{font-style:italic;color:#333}.markdown-body .pl-mb{font-weight:700;color:#333}.markdown-body .pl-md{color:#bd2c00;background-color:#ffecec}.markdown-body .pl-mi1{color:#55a532;background-color:#eaffea}.markdown-body .pl-mdr{font-weight:700;color:#795da3}.markdown-body .pl-mo{color:#1d3e81}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body hr::after,.markdown-body hr::before,.markdown-body::after,.markdown-body::before{display:table;content:""}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects;color:#4078c0;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{outline-width:0;text-decoration:underline}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body hr{box-sizing:content-box}.markdown-body input{font:inherit;margin:0;overflow:visible;font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body strong{font-weight:600}.markdown-body td,.markdown-body th{padding:0}.markdown-body blockquote{margin:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code{font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre{font:12px Consolas,"Liberation Mono",Menlo,Courier,monospace;word-wrap:normal}.markdown-body input{-webkit-font-feature-settings:"liga" 0;font-feature-settings:"liga" 0}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:0}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{overflow:hidden;background:#e7e7e7;height:.25em;padding:0;margin:24px 0;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#000;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1{font-size:2em}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{border-spacing:0;border-collapse:collapse;display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.markdown-body code::after,.markdown-body code::before{letter-spacing:-.2em;content:"\00a0"}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code::after,.markdown-body pre code::before{content:normal}.markdown-body .pl-0{padding-left:0!important}.markdown-body .pl-1{padding-left:3px!important}.markdown-body .pl-2{padding-left:6px!important}.markdown-body .pl-3{padding-left:12px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:36px!important}.markdown-body .pl-6{padding-left:48px!important}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#4078c0;border:1px solid #4078c0}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px Consolas,"Liberation Mono",Menlo,Courier,monospace;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid #ccc;border-bottom-color:#bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#4078c0}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body hr{border-bottom-color:#eee}
/**  https://github.com/LukeAskew/prism-github */
code,code[class*=language-],pre[class*=language-]{color:#333;text-align:left;white-space:pre;word-spacing:normal;tab-size:4;hyphens:none;font-family:Consolas,'Liberation Mono',Menlo,Courier,monospace;line-height:1.4;direction:ltr;cursor:text}pre[class*=language-]{overflow:auto;margin:1em 0;padding:1.2em;border-radius:3px;font-size:85%}li code,p code,table code{margin:0;border-radius:3px;padding:.2em 0;font-size:85%}li code:after,li code:before,p code:after,p code:before,table code:after,table code:before{letter-spacing:-.2em;content:'\00a0'}:not(pre)>code[class*=language-],code,pre[class*=language-]{background:#f7f7f7}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#969896}.token.atrule,.token.attr-value,.token.punctuation,.token.string{color:#183691}.token.property,.token.tag{color:#63a35c}.token.boolean,.token.number{color:#0086b3}.language-css .token.string,.token.attr-name,.token.attr-value .punctuation:first-child,.token.entity,.token.important,.token.keyword,.token.operator,.token.regex,.token.selector,.token.url{color:#a71d5d}.token.entity{cursor:help}.namespace{opacity:.7}
.token.function {/* fix prism function color */color: #0086b3;}
.markdown-body{padding: 1.25rem 1.5rem 0;}
</style>
</head>
<body class="markdown-body">
  <?php echo $content; ?>
<script>
/* https://github.com/PrismJS/prism */
var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,a=_self.Prism={util:{encode:function(e){return e instanceof n?new n(e.type,a.util.encode(e.content),e.alias):"Array"===a.util.type(e)?e.map(a.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){var t=a.util.type(e);switch(t){case"Object":var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=a.util.clone(e[r]));return n;case"Array":return e.map&&e.map(function(e){return a.util.clone(e)})}return e}},languages:{extend:function(e,t){var n=a.util.clone(a.languages[e]);for(var r in t)n[r]=t[r];return n},insertBefore:function(e,t,n,r){r=r||a.languages;var i=r[e];if(2==arguments.length){n=arguments[1];for(var s in n)n.hasOwnProperty(s)&&(i[s]=n[s]);return i}var l={};for(var o in i)if(i.hasOwnProperty(o)){if(o==t)for(var s in n)n.hasOwnProperty(s)&&(l[s]=n[s]);l[o]=i[o]}return a.languages.DFS(a.languages,function(t,a){a===r[e]&&t!=e&&(this[t]=l)}),r[e]=l},DFS:function(e,t,n,r){r=r||{};for(var i in e)e.hasOwnProperty(i)&&(t.call(e,i,e[i],n||i),"Object"!==a.util.type(e[i])||r[a.util.objId(e[i])]?"Array"!==a.util.type(e[i])||r[a.util.objId(e[i])]||(r[a.util.objId(e[i])]=!0,a.languages.DFS(e[i],t,i,r)):(r[a.util.objId(e[i])]=!0,a.languages.DFS(e[i],t,null,r)))}},plugins:{},highlightAll:function(e,t){var n={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",n);for(var r,i=n.elements||document.querySelectorAll(n.selector),s=0;r=i[s++];)a.highlightElement(r,e===!0,n.callback)},highlightElement:function(t,n,r){for(var i,s,l=t;l&&!e.test(l.className);)l=l.parentNode;l&&(i=(l.className.match(e)||[,""])[1].toLowerCase(),s=a.languages[i]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+i,l=t.parentNode,/pre/i.test(l.nodeName)&&(l.className=l.className.replace(e,"").replace(/\s+/g," ")+" language-"+i);var o=t.textContent,u={element:t,language:i,grammar:s,code:o};if(a.hooks.run("before-sanity-check",u),!u.code||!u.grammar)return u.code&&(u.element.textContent=u.code),void a.hooks.run("complete",u);if(a.hooks.run("before-highlight",u),n&&_self.Worker){var g=new Worker(a.filename);g.onmessage=function(e){u.highlightedCode=e.data,a.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(u.element),a.hooks.run("after-highlight",u),a.hooks.run("complete",u)},g.postMessage(JSON.stringify({language:u.language,code:u.code,immediateClose:!0}))}else u.highlightedCode=a.highlight(u.code,u.grammar,u.language),a.hooks.run("before-insert",u),u.element.innerHTML=u.highlightedCode,r&&r.call(t),a.hooks.run("after-highlight",u),a.hooks.run("complete",u)},highlight:function(e,t,r){var i=a.tokenize(e,t);return n.stringify(a.util.encode(i),r)},tokenize:function(e,t,n){var r=a.Token,i=[e],s=t.rest;if(s){for(var l in s)t[l]=s[l];delete t.rest}e:for(var l in t)if(t.hasOwnProperty(l)&&t[l]){var o=t[l];o="Array"===a.util.type(o)?o:[o];for(var u=0;u<o.length;++u){var g=o[u],c=g.inside,p=!!g.lookbehind,d=!!g.greedy,m=0,h=g.alias;if(d&&!g.pattern.global){var f=g.pattern.toString().match(/[imuy]*$/)[0];g.pattern=RegExp(g.pattern.source,f+"g")}g=g.pattern||g;for(var y=0,b=0;y<i.length;b+=i[y].length,++y){var v=i[y];if(i.length>e.length)break e;if(!(v instanceof r)){g.lastIndex=0;var w=g.exec(v),k=1;if(!w&&d&&y!=i.length-1){if(g.lastIndex=b,w=g.exec(e),!w)break;for(var P=w.index+(p?w[1].length:0),x=w.index+w[0].length,A=y,j=b,_=i.length;A<_&&j<x;++A)j+=i[A].length,P>=j&&(++y,b=j);if(i[y]instanceof r||i[A-1].greedy)continue;k=A-y,v=e.slice(b,j),w.index-=b}if(w){p&&(m=w[1].length);var P=w.index+m,w=w[0].slice(m),x=P+w.length,C=v.slice(0,P),E=v.slice(x),N=[y,k];C&&N.push(C);var S=new r(l,c?a.tokenize(w,c):w,h,w,d);N.push(S),E&&N.push(E),Array.prototype.splice.apply(i,N)}}}}}return i},hooks:{all:{},add:function(e,t){var n=a.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=a.hooks.all[e];if(n&&n.length)for(var r,i=0;r=n[i++];)r(t)}}},n=a.Token=function(e,t,a,n,r){this.type=e,this.content=t,this.alias=a,this.length=0|(n||"").length,this.greedy=!!r};if(n.stringify=function(e,t,r){if("string"==typeof e)return e;if("Array"===a.util.type(e))return e.map(function(a){return n.stringify(a,t,e)}).join("");var i={type:e.type,content:n.stringify(e.content,t,r),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:r};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var s="Array"===a.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,s)}a.hooks.run("wrap",i);var l=Object.keys(i.attributes).map(function(e){return e+'="'+(i.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+(l?" "+l:"")+">"+i.content+"</"+i.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",function(e){var t=JSON.parse(e.data),n=t.language,r=t.code,i=t.immediateClose;_self.postMessage(a.highlight(r,a.languages[n],n)),i&&_self.close()},!1),_self.Prism):_self.Prism;var r=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return r&&(a.filename=r.src,document.addEventListener&&!r.hasAttribute("data-manual")&&("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(a.highlightAll):window.setTimeout(a.highlightAll,16):document.addEventListener("DOMContentLoaded",a.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(true|false)\b/,function:/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,function:/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript,function(){"undefined"!=typeof self&&self.Prism&&self.document&&document.querySelector&&(self.Prism.fileHighlight=function(){var e={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"};Array.prototype.forEach&&Array.prototype.slice.call(document.querySelectorAll("pre[data-src]")).forEach(function(t){for(var a,n=t.getAttribute("data-src"),r=t,i=/\blang(?:uage)?-(?!\*)(\w+)\b/i;r&&!i.test(r.className);)r=r.parentNode;if(r&&(a=(t.className.match(i)||[,""])[1]),!a){var s=(n.match(/\.(\w+)$/)||[,""])[1];a=e[s]||s}var l=document.createElement("code");l.className="language-"+a,t.textContent="",l.textContent="Loading…",t.appendChild(l);var o=new XMLHttpRequest;o.open("GET",n,!0),o.onreadystatechange=function(){4==o.readyState&&(o.status<400&&o.responseText?(l.textContent=o.responseText,Prism.highlightElement(l)):o.status>=400?l.textContent="✖ Error "+o.status+" while fetching file: "+o.statusText:l.textContent="✖ Error: File does not exist or is empty")},o.send(null)})},document.addEventListener("DOMContentLoaded",self.Prism.fileHighlight))}();
/* Prism - PHP */
Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,"package":{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",function(e){"php"===e.language&&(e.tokenStack=[],e.backupCode=e.code,e.code=e.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,function(a){return e.tokenStack.push(a),"{{{PHP"+e.tokenStack.length+"}}}"}))}),Prism.hooks.add("before-insert",function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)}),Prism.hooks.add("after-highlight",function(e){if("php"===e.language){for(var a,n=0;a=e.tokenStack[n];n++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(n+1)+"}}}",Prism.highlight(a,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}}),Prism.hooks.add("wrap",function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))}),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/}));
</script>
</body>
</html>
<?php } 
/** Parsedown: http://parsedown.org, (c) Emanuil Rusev: http://erusev.com For the full license information, view the LICENSE file that was distributed with this source code */
class Parsedown{const version='1.6.0';function text($text){$this->DefinitionData=array();$text=str_replace(array("\r\n","\r"),"\n",$text);$text=trim($text,"\n");$lines=explode("\n",$text);$markup=$this->lines($lines);$markup=trim($markup,"\n");return$markup;}function setBreaksEnabled($breaksEnabled){$this->breaksEnabled=$breaksEnabled;return$this;}protected$breaksEnabled;function setMarkupEscaped($markupEscaped){$this->markupEscaped=$markupEscaped;return$this;}protected$markupEscaped;function setUrlsLinked($urlsLinked){$this->urlsLinked=$urlsLinked;return$this;}protected$urlsLinked=true;protected$BlockTypes=array('#'=>array('Header'),'*'=>array('Rule','List'),'+'=>array('List'),'-'=>array('SetextHeader','Table','Rule','List'),'0'=>array('List'),'1'=>array('List'),'2'=>array('List'),'3'=>array('List'),'4'=>array('List'),'5'=>array('List'),'6'=>array('List'),'7'=>array('List'),'8'=>array('List'),'9'=>array('List'),':'=>array('Table'),'<'=>array('Comment','Markup'),'='=>array('SetextHeader'),'>'=>array('Quote'),'['=>array('Reference'),'_'=>array('Rule'),'`'=>array('FencedCode'),'|'=>array('Table'),'~'=>array('FencedCode'),);protected$unmarkedBlockTypes=array('Code',);protected function lines(array$lines){$CurrentBlock=null;foreach($lines as$line){if(chop($line)===''){if(isset($CurrentBlock)){$CurrentBlock['interrupted']=true;}continue;}if(strpos($line,"\t")!==false){$parts=explode("\t",$line);$line=$parts[0];unset($parts[0]);foreach($parts as$part){$shortage=4-mb_strlen($line,'utf-8')%4;$line.=str_repeat(' ',$shortage);$line.=$part;}}$indent=0;while(isset($line[$indent])and$line[$indent]===' '){$indent++;}$text=$indent>0?substr($line,$indent):$line;$Line=array('body'=>$line,'indent'=>$indent,'text'=>$text);if(isset($CurrentBlock['continuable'])){$Block=$this->{'block'.$CurrentBlock['type'].'Continue'}($Line,$CurrentBlock);if(isset($Block)){$CurrentBlock=$Block;continue;}else{if($this->isBlockCompletable($CurrentBlock['type'])){$CurrentBlock=$this->{'block'.$CurrentBlock['type'].'Complete'}($CurrentBlock);}}}$marker=$text[0];$blockTypes=$this->unmarkedBlockTypes;if(isset($this->BlockTypes[$marker])){foreach($this->BlockTypes[$marker] as$blockType){$blockTypes []=$blockType;}}foreach($blockTypes as$blockType){$Block=$this->{'block'.$blockType}($Line,$CurrentBlock);if(isset($Block)){$Block['type']=$blockType;if(!isset($Block['identified'])){$Blocks []=$CurrentBlock;$Block['identified']=true;}if($this->isBlockContinuable($blockType)){$Block['continuable']=true;}$CurrentBlock=$Block;continue 2;}}if(isset($CurrentBlock)and!isset($CurrentBlock['type'])and!isset($CurrentBlock['interrupted'])){$CurrentBlock['element']['text'].="\n".$text;}else{$Blocks []=$CurrentBlock;$CurrentBlock=$this->paragraph($Line);$CurrentBlock['identified']=true;}}if(isset($CurrentBlock['continuable'])and$this->isBlockCompletable($CurrentBlock['type'])){$CurrentBlock=$this->{'block'.$CurrentBlock['type'].'Complete'}($CurrentBlock);}$Blocks []=$CurrentBlock;unset($Blocks[0]);$markup='';foreach($Blocks as$Block){if(isset($Block['hidden'])){continue;}$markup.="\n";$markup.=isset($Block['markup'])?$Block['markup']:$this->element($Block['element']);}$markup.="\n";return$markup;}protected function isBlockContinuable($Type){return method_exists($this,'block'.$Type.'Continue');}protected function isBlockCompletable($Type){return method_exists($this,'block'.$Type.'Complete');}protected function blockCode($Line,$Block=null){if(isset($Block)and!isset($Block['type'])and!isset($Block['interrupted'])){return;}if($Line['indent']>=4){$text=substr($Line['body'],4);$Block=array('element'=>array('name'=>'pre','handler'=>'element','text'=>array('name'=>'code','text'=>$text,),),);return$Block;}}protected function blockCodeContinue($Line,$Block){if($Line['indent']>=4){if(isset($Block['interrupted'])){$Block['element']['text']['text'].="\n";unset($Block['interrupted']);}$Block['element']['text']['text'].="\n";$text=substr($Line['body'],4);$Block['element']['text']['text'].=$text;return$Block;}}protected function blockCodeComplete($Block){$text=$Block['element']['text']['text'];$text=htmlspecialchars($text,ENT_NOQUOTES,'UTF-8');$Block['element']['text']['text']=$text;return$Block;}protected function blockComment($Line){if($this->markupEscaped){return;}if(isset($Line['text'][3])and$Line['text'][3]==='-' and$Line['text'][2]==='-' and$Line['text'][1]==='!'){$Block=array('markup'=>$Line['body'],);if(preg_match('/-->$/',$Line['text'])){$Block['closed']=true;}return$Block;}}protected function blockCommentContinue($Line,array$Block){if(isset($Block['closed'])){return;}$Block['markup'].="\n".$Line['body'];if(preg_match('/-->$/',$Line['text'])){$Block['closed']=true;}return$Block;}protected function blockFencedCode($Line){if(preg_match('/^['.$Line['text'][0].']{3,}[ ]*([\w-]+)?[ ]*$/',$Line['text'],$matches)){$Element=array('name'=>'code','text'=>'',);if(isset($matches[1])){$class='language-'.$matches[1];$Element['attributes']=array('class'=>$class,);}$Block=array('char'=>$Line['text'][0],'element'=>array('name'=>'pre','handler'=>'element','text'=>$Element,),);return$Block;}}protected function blockFencedCodeContinue($Line,$Block){if(isset($Block['complete'])){return;}if(isset($Block['interrupted'])){$Block['element']['text']['text'].="\n";unset($Block['interrupted']);}if(preg_match('/^'.$Block['char'].'{3,}[ ]*$/',$Line['text'])){$Block['element']['text']['text']=substr($Block['element']['text']['text'],1);$Block['complete']=true;return$Block;}$Block['element']['text']['text'].="\n".$Line['body'];;return$Block;}protected function blockFencedCodeComplete($Block){$text=$Block['element']['text']['text'];$text=htmlspecialchars($text,ENT_NOQUOTES,'UTF-8');$Block['element']['text']['text']=$text;return$Block;}protected function blockHeader($Line){if(isset($Line['text'][1])){$level=1;while(isset($Line['text'][$level])and$Line['text'][$level]==='#'){$level++;}if($level>6){return;}$text=trim($Line['text'],'# ');$Block=array('element'=>array('name'=>'h'.min(6,$level),'text'=>$text,'handler'=>'line',),);return$Block;}}protected function blockList($Line){list($name,$pattern)=$Line['text'][0]<='-'?array('ul','[*+-]'):array('ol','[0-9]+[.]');if(preg_match('/^('.$pattern.'[ ]+)(.*)/',$Line['text'],$matches)){$Block=array('indent'=>$Line['indent'],'pattern'=>$pattern,'element'=>array('name'=>$name,'handler'=>'elements',),);if($name==='ol'){$listStart=stristr($matches[0],'.',true);if($listStart!=='1'){$Block['element']['attributes']=array('start'=>$listStart);}}$Block['li']=array('name'=>'li','handler'=>'li','text'=>array($matches[2],),);$Block['element']['text'] []=&$Block['li'];return$Block;}}protected function blockListContinue($Line,array$Block){if($Block['indent']===$Line['indent'] and preg_match('/^'.$Block['pattern'].'(?:[ ]+(.*)|$)/',$Line['text'],$matches)){if(isset($Block['interrupted'])){$Block['li']['text'] []='';unset($Block['interrupted']);}unset($Block['li']);$text=isset($matches[1])?$matches[1]:'';$Block['li']=array('name'=>'li','handler'=>'li','text'=>array($text,),);$Block['element']['text'] []=&$Block['li'];return$Block;}if($Line['text'][0]==='[' and$this->blockReference($Line)){return$Block;}if(!isset($Block['interrupted'])){$text=preg_replace('/^[ ]{0,4}/','',$Line['body']);$Block['li']['text'] []=$text;return$Block;}if($Line['indent']>0){$Block['li']['text'] []='';$text=preg_replace('/^[ ]{0,4}/','',$Line['body']);$Block['li']['text'] []=$text;unset($Block['interrupted']);return$Block;}}protected function blockQuote($Line){if(preg_match('/^>[ ]?(.*)/',$Line['text'],$matches)){$Block=array('element'=>array('name'=>'blockquote','handler'=>'lines','text'=>(array)$matches[1],),);return$Block;}}protected function blockQuoteContinue($Line,array$Block){if($Line['text'][0]==='>' and preg_match('/^>[ ]?(.*)/',$Line['text'],$matches)){if(isset($Block['interrupted'])){$Block['element']['text'] []='';unset($Block['interrupted']);}$Block['element']['text'] []=$matches[1];return$Block;}if(!isset($Block['interrupted'])){$Block['element']['text'] []=$Line['text'];return$Block;}}protected function blockRule($Line){if(preg_match('/^(['.$Line['text'][0].'])([ ]*\1){2,}[ ]*$/',$Line['text'])){$Block=array('element'=>array('name'=>'hr'),);return$Block;}}protected function blockSetextHeader($Line,array$Block=null){if(!isset($Block)or isset($Block['type'])or isset($Block['interrupted'])){return;}if(chop($Line['text'],$Line['text'][0])===''){$Block['element']['name']=$Line['text'][0]==='='?'h1':'h2';return$Block;}}protected function blockMarkup($Line){if($this->markupEscaped){return;}if(preg_match('/^<(\w*)(?:[ ]*'.$this->regexHtmlAttribute.')*[ ]*(\/)?>/',$Line['text'],$matches)){$element=strtolower($matches[1]);if(in_array($element,$this->textLevelElements)){return;}$Block=array('name'=>$matches[1],'depth'=>0,'markup'=>$Line['text'],);$length=strlen($matches[0]);$remainder=substr($Line['text'],$length);if(trim($remainder)===''){if(isset($matches[2])or in_array($matches[1],$this->voidElements)){$Block['closed']=true;$Block['void']=true;}}else{if(isset($matches[2])or in_array($matches[1],$this->voidElements)){return;}if(preg_match('/<\/'.$matches[1].'>[ ]*$/i',$remainder)){$Block['closed']=true;}}return$Block;}}protected function blockMarkupContinue($Line,array$Block){if(isset($Block['closed'])){return;}if(preg_match('/^<'.$Block['name'].'(?:[ ]*'.$this->regexHtmlAttribute.')*[ ]*>/i',$Line['text'])){$Block['depth']++;}if(preg_match('/(.*?)<\/'.$Block['name'].'>[ ]*$/i',$Line['text'],$matches)){if($Block['depth']>0){$Block['depth']--;}else{$Block['closed']=true;}}if(isset($Block['interrupted'])){$Block['markup'].="\n";unset($Block['interrupted']);}$Block['markup'].="\n".$Line['body'];return$Block;}protected function blockReference($Line){if(preg_match('/^\[(.+?)\]:[ ]*<?(\S+?)>?(?:[ ]+["\'(](.+)["\')])?[ ]*$/',$Line['text'],$matches)){$id=strtolower($matches[1]);$Data=array('url'=>$matches[2],'title'=>null,);if(isset($matches[3])){$Data['title']=$matches[3];}$this->DefinitionData['Reference'][$id]=$Data;$Block=array('hidden'=>true,);return$Block;}}protected function blockTable($Line,array$Block=null){if(!isset($Block)or isset($Block['type'])or isset($Block['interrupted'])){return;}if(strpos($Block['element']['text'],'|')!==false and chop($Line['text'],' -:|')===''){$alignments=array();$divider=$Line['text'];$divider=trim($divider);$divider=trim($divider,'|');$dividerCells=explode('|',$divider);foreach($dividerCells as$dividerCell){$dividerCell=trim($dividerCell);if($dividerCell===''){continue;}$alignment=null;if($dividerCell[0]===':'){$alignment='left';}if(substr($dividerCell,-1)===':'){$alignment=$alignment==='left'?'center':'right';}$alignments []=$alignment;}$HeaderElements=array();$header=$Block['element']['text'];$header=trim($header);$header=trim($header,'|');$headerCells=explode('|',$header);foreach($headerCells as$index=>$headerCell){$headerCell=trim($headerCell);$HeaderElement=array('name'=>'th','text'=>$headerCell,'handler'=>'line',);if(isset($alignments[$index])){$alignment=$alignments[$index];$HeaderElement['attributes']=array('style'=>'text-align: '.$alignment.';',);}$HeaderElements []=$HeaderElement;}$Block=array('alignments'=>$alignments,'identified'=>true,'element'=>array('name'=>'table','handler'=>'elements',),);$Block['element']['text'] []=array('name'=>'thead','handler'=>'elements',);$Block['element']['text'] []=array('name'=>'tbody','handler'=>'elements','text'=>array(),);$Block['element']['text'][0]['text'] []=array('name'=>'tr','handler'=>'elements','text'=>$HeaderElements,);return$Block;}}protected function blockTableContinue($Line,array$Block){if(isset($Block['interrupted'])){return;}if($Line['text'][0]==='|' or strpos($Line['text'],'|')){$Elements=array();$row=$Line['text'];$row=trim($row);$row=trim($row,'|');preg_match_all('/(?:(\\\\[|])|[^|`]|`[^`]+`|`)+/',$row,$matches);foreach($matches[0] as$index=>$cell){$cell=trim($cell);$Element=array('name'=>'td','handler'=>'line','text'=>$cell,);if(isset($Block['alignments'][$index])){$Element['attributes']=array('style'=>'text-align: '.$Block['alignments'][$index].';',);}$Elements []=$Element;}$Element=array('name'=>'tr','handler'=>'elements','text'=>$Elements,);$Block['element']['text'][1]['text'] []=$Element;return$Block;}}protected function paragraph($Line){$Block=array('element'=>array('name'=>'p','text'=>$Line['text'],'handler'=>'line',),);return$Block;}protected$InlineTypes=array('"'=>array('SpecialCharacter'),'!'=>array('Image'),'&'=>array('SpecialCharacter'),'*'=>array('Emphasis'),':'=>array('Url'),'<'=>array('UrlTag','EmailTag','Markup','SpecialCharacter'),'>'=>array('SpecialCharacter'),'['=>array('Link'),'_'=>array('Emphasis'),'`'=>array('Code'),'~'=>array('Strikethrough'),'\\'=>array('EscapeSequence'),);protected$inlineMarkerList='!"*_&[:<>`~\\';public function line($text){$markup='';while($excerpt=strpbrk($text,$this->inlineMarkerList)){$marker=$excerpt[0];$markerPosition=strpos($text,$marker);$Excerpt=array('text'=>$excerpt,'context'=>$text);foreach($this->InlineTypes[$marker] as$inlineType){$Inline=$this->{'inline'.$inlineType}($Excerpt);if(!isset($Inline)){continue;}if(isset($Inline['position'])and$Inline['position']>$markerPosition){continue;}if(!isset($Inline['position'])){$Inline['position']=$markerPosition;}$unmarkedText=substr($text,0,$Inline['position']);$markup.=$this->unmarkedText($unmarkedText);$markup.=isset($Inline['markup'])?$Inline['markup']:$this->element($Inline['element']);$text=substr($text,$Inline['position']+$Inline['extent']);continue 2;}$unmarkedText=substr($text,0,$markerPosition+1);$markup.=$this->unmarkedText($unmarkedText);$text=substr($text,$markerPosition+1);}$markup.=$this->unmarkedText($text);return$markup;}protected function inlineCode($Excerpt){$marker=$Excerpt['text'][0];if(preg_match('/^('.$marker.'+)[ ]*(.+?)[ ]*(?<!'.$marker.')\1(?!'.$marker.')/s',$Excerpt['text'],$matches)){$text=$matches[2];$text=htmlspecialchars($text,ENT_NOQUOTES,'UTF-8');$text=preg_replace("/[ ]*\n/",' ',$text);return array('extent'=>strlen($matches[0]),'element'=>array('name'=>'code','text'=>$text,),);}}protected function inlineEmailTag($Excerpt){if(strpos($Excerpt['text'],'>')!==false and preg_match('/^<((mailto:)?\S+?@\S+?)>/i',$Excerpt['text'],$matches)){$url=$matches[1];if(!isset($matches[2])){$url='mailto:'.$url;}return array('extent'=>strlen($matches[0]),'element'=>array('name'=>'a','text'=>$matches[1],'attributes'=>array('href'=>$url,),),);}}protected function inlineEmphasis($Excerpt){if(!isset($Excerpt['text'][1])){return;}$marker=$Excerpt['text'][0];if($Excerpt['text'][1]===$marker and preg_match($this->StrongRegex[$marker],$Excerpt['text'],$matches)){$emphasis='strong';}elseif(preg_match($this->EmRegex[$marker],$Excerpt['text'],$matches)){$emphasis='em';}else{return;}return array('extent'=>strlen($matches[0]),'element'=>array('name'=>$emphasis,'handler'=>'line','text'=>$matches[1],),);}protected function inlineEscapeSequence($Excerpt){if(isset($Excerpt['text'][1])and in_array($Excerpt['text'][1],$this->specialCharacters)){return array('markup'=>$Excerpt['text'][1],'extent'=>2,);}}protected function inlineImage($Excerpt){if(!isset($Excerpt['text'][1])or$Excerpt['text'][1]!=='['){return;}$Excerpt['text']=substr($Excerpt['text'],1);$Link=$this->inlineLink($Excerpt);if($Link===null){return;}$Inline=array('extent'=>$Link['extent']+1,'element'=>array('name'=>'img','attributes'=>array('src'=>$Link['element']['attributes']['href'],'alt'=>$Link['element']['text'],),),);$Inline['element']['attributes']+=$Link['element']['attributes'];unset($Inline['element']['attributes']['href']);return$Inline;}protected function inlineLink($Excerpt){$Element=array('name'=>'a','handler'=>'line','text'=>null,'attributes'=>array('href'=>null,'title'=>null,),);$extent=0;$remainder=$Excerpt['text'];if(preg_match('/\[((?:[^][]++|(?R))*+)\]/',$remainder,$matches)){$Element['text']=$matches[1];$extent+=strlen($matches[0]);$remainder=substr($remainder,$extent);}else{return;}if(preg_match('/^[(]((?:[^ ()]++|[(][^ )]+[)])++)(?:[ ]+("[^"]*"|\'[^\']*\'))?[)]/',$remainder,$matches)){$Element['attributes']['href']=$matches[1];if(isset($matches[2])){$Element['attributes']['title']=substr($matches[2],1,-1);}$extent+=strlen($matches[0]);}else{if(preg_match('/^\s*\[(.*?)\]/',$remainder,$matches)){$definition=strlen($matches[1])?$matches[1]:$Element['text'];$definition=strtolower($definition);$extent+=strlen($matches[0]);}else{$definition=strtolower($Element['text']);}if(!isset($this->DefinitionData['Reference'][$definition])){return;}$Definition=$this->DefinitionData['Reference'][$definition];$Element['attributes']['href']=$Definition['url'];$Element['attributes']['title']=$Definition['title'];}$Element['attributes']['href']=str_replace(array('&','<'),array('&amp;','&lt;'),$Element['attributes']['href']);return array('extent'=>$extent,'element'=>$Element,);}protected function inlineMarkup($Excerpt){if($this->markupEscaped or strpos($Excerpt['text'],'>')===false){return;}if($Excerpt['text'][1]==='/' and preg_match('/^<\/\w*[ ]*>/s',$Excerpt['text'],$matches)){return array('markup'=>$matches[0],'extent'=>strlen($matches[0]),);}if($Excerpt['text'][1]==='!' and preg_match('/^<!---?[^>-](?:-?[^-])*-->/s',$Excerpt['text'],$matches)){return array('markup'=>$matches[0],'extent'=>strlen($matches[0]),);}if($Excerpt['text'][1]!==' ' and preg_match('/^<\w*(?:[ ]*'.$this->regexHtmlAttribute.')*[ ]*\/?>/s',$Excerpt['text'],$matches)){return array('markup'=>$matches[0],'extent'=>strlen($matches[0]),);}}protected function inlineSpecialCharacter($Excerpt){if($Excerpt['text'][0]==='&' and!preg_match('/^&#?\w+;/',$Excerpt['text'])){return array('markup'=>'&amp;','extent'=>1,);}$SpecialCharacter=array('>'=>'gt','<'=>'lt','"'=>'quot');if(isset($SpecialCharacter[$Excerpt['text'][0]])){return array('markup'=>'&'.$SpecialCharacter[$Excerpt['text'][0]].';','extent'=>1,);}}protected function inlineStrikethrough($Excerpt){if(!isset($Excerpt['text'][1])){return;}if($Excerpt['text'][1]==='~' and preg_match('/^~~(?=\S)(.+?)(?<=\S)~~/',$Excerpt['text'],$matches)){return array('extent'=>strlen($matches[0]),'element'=>array('name'=>'del','text'=>$matches[1],'handler'=>'line',),);}}protected function inlineUrl($Excerpt){if($this->urlsLinked!==true or!isset($Excerpt['text'][2])or$Excerpt['text'][2]!=='/'){return;}if(preg_match('/\bhttps?:[\/]{2}[^\s<]+\b\/*/ui',$Excerpt['context'],$matches,PREG_OFFSET_CAPTURE)){$Inline=array('extent'=>strlen($matches[0][0]),'position'=>$matches[0][1],'element'=>array('name'=>'a','text'=>$matches[0][0],'attributes'=>array('href'=>$matches[0][0],),),);return$Inline;}}protected function inlineUrlTag($Excerpt){if(strpos($Excerpt['text'],'>')!==false and preg_match('/^<(\w+:\/{2}[^ >]+)>/i',$Excerpt['text'],$matches)){$url=str_replace(array('&','<'),array('&amp;','&lt;'),$matches[1]);return array('extent'=>strlen($matches[0]),'element'=>array('name'=>'a','text'=>$url,'attributes'=>array('href'=>$url,),),);}}protected function unmarkedText($text){if($this->breaksEnabled){$text=preg_replace('/[ ]*\n/',"<br />\n",$text);}else{$text=preg_replace('/(?:[ ][ ]+|[ ]*\\\\)\n/',"<br />\n",$text);$text=str_replace(" \n","\n",$text);}return$text;}protected function element(array$Element){$markup='<'.$Element['name'];if(isset($Element['attributes'])){foreach($Element['attributes'] as$name=>$value){if($value===null){continue;}$markup.=' '.$name.'="'.$value.'"';}}if(isset($Element['text'])){$markup.='>';if(isset($Element['handler'])){$markup.=$this->{$Element['handler']}($Element['text']);}else{$markup.=$Element['text'];}$markup.='</'.$Element['name'].'>';}else{$markup.=' />';}return$markup;}protected function elements(array$Elements){$markup='';foreach($Elements as$Element){$markup.="\n".$this->element($Element);}$markup.="\n";return$markup;}protected function li($lines){$markup=$this->lines($lines);$trimmedMarkup=trim($markup);if(!in_array('',$lines)and substr($trimmedMarkup,0,3)==='<p>'){$markup=$trimmedMarkup;$markup=substr($markup,3);$position=strpos($markup,"</p>");$markup=substr_replace($markup,'',$position,4);}return$markup;}function parse($text){$markup=$this->text($text);return$markup;}static function instance($name='default'){if(isset(self::$instances[$name])){return self::$instances[$name];}$instance=new static();self::$instances[$name]=$instance;return$instance;}private static$instances=array();protected$DefinitionData;protected$specialCharacters=array('\\','`','*','_','{','}','[',']','(',')','>','#','+','-','.','!','|',);protected$StrongRegex=array('*'=>'/^[*]{2}((?:\\\\\*|[^*]|[*][^*]*[*])+?)[*]{2}(?![*])/s','_'=>'/^__((?:\\\\_|[^_]|_[^_]*_)+?)__(?!_)/us',);protected$EmRegex=array('*'=>'/^[*]((?:\\\\\*|[^*]|[*][*][^*]+?[*][*])+?)[*](?![*])/s','_'=>'/^_((?:\\\\_|[^_]|__[^_]*__)+?)_(?!_)\b/us',);protected$regexHtmlAttribute='[a-zA-Z_:][\w:.-]*(?:\s*=\s*(?:[^"\'=<>`\s]+|"[^"]*"|\'[^\']*\'))?';protected$voidElements=array('area','base','br','col','command','embed','hr','img','input','link','meta','param','source',);protected$textLevelElements=array('a','br','bdo','abbr','blink','nextid','acronym','basefont','b','em','big','cite','small','spacer','listing','i','rp','del','code','strike','marquee','q','rt','ins','font','strong','s','tt','sub','mark','u','xm','sup','nobr','var','ruby','wbr','span','time',);}?>